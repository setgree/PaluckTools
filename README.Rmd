---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# PaluckTools

<!-- badges: start -->
<!-- badges: end -->

PaluckTools documents the [Paluck lab's](http://www.betsylevypaluck.com/) approach to conducting meta-analyses and analyzing experimental data.

This package integrates functions from three sources:

* [PaluckMetaSOP](https://github.com/setgree/PaluckMetaSOP) - meta-analysis functions featured in "[The Contact Hypothesis Re-evaluated](https://doi.org/10.1017/bpp.2018.25)" and "[Preventing Sexual Violence —A Behavioral Problem Without a Behaviorally-Informed Solution](https://doi.org/10.1177/15291006231221978)"
* [blpl](https://github.com/johnhenrypezzuto/blpl) - John-Henry Pezzuto's experimental analysis and table formatting tools
* [prejudice-reduction-code-and-data](https://github.com/setgree/prejudice-reduction-code-and-data) - additional helper functions for effect size conversion and data preparation

## Installation

Run the following R command:

```r
remotes::install_github('setgree/PaluckTools', build_vignettes = TRUE)
```

## What you'll find

This package contains:

- **Functions** for meta-analysis and experimental analysis
- **Vignettes** that walk through different workflows
- **Datasets**:
  - `sv_data` - Sexual violence prevention meta-analysis
  - `contact_data` - Contact hypothesis meta-analysis
  - `map_reduction_data` - Meat/animal product reduction meta-analysis (Green et al., 2025)

## Getting started

After installation, run:

```r
browseVignettes(package = "PaluckTools")
```

We recommend starting with the overview vignette, which will guide you to the right workflow for your needs.

## Quick Start

### Convert a t-test to Cohen's d

```r
library(PaluckTools)

# You have: t = 2.5, n_treatment = 30, n_control = 30
d <- d_calc(stat_type = "t_test", stat = 2.5, n_t = 30, n_c = 30)
variance <- var_d_calc(stat_type = "t_test", stat = 2.5, n_t = 30, n_c = 30)

# Result: d = 0.645, variance = 0.069
```

### Run a quick meta-analysis

```r
library(dplyr)

# Use built-in contact hypothesis data
contact_data |>
  map_robust() |>
  print()

# Result shows pooled effect size, SE, CI, and heterogeneity
```

### Get cluster-robust standard errors

```r
# Your regression
model <- lm(outcome ~ treatment + control, data = your_data)

# Add cluster-robust SEs
robust_results <- robust_se(model, cluster = your_data$school_id)
robust_results[[2]]  # Coefficient table with robust SEs
```

### Run multiple regression specifications

```r
# Test treatment on multiple outcomes with different controls
models <- tidy_lm(
  data = your_data,
  dv = c("test_score", "attendance", "attitudes"),
  terms = c("treatment", "baseline_score", "gender"),
  treatment = "treatment",
  style = "incremental"  # Progressively adds controls
)

# Extract treatment effects
models |> select(dv, treatment_coef, treatment_p)
```

## The functions

### Meta-analysis workflow

#### Effect size calculation:
* `d_calc`: Calculate standardized mean differences (Cohen's D/Glass's ∆)
* `var_d_calc`: Calculate variance of effect sizes
* `ci_2_sd`, `se_2_sd`, `sd_pooled`, `did_calculator`: Helper functions for data preparation

#### Running meta-analyses:
* `map_robust`: Tidyverse-friendly wrapper around `metafor::robust()` for robust variance estimation

#### Writing and visualization:
* `study_count`: Count unique studies in grouped data
* `summarise_lm`: Pipe-friendly wrapper for `summary(lm())`
* `summarise_table`: Pipe-friendly version of `table()`
* `make_bib`: Generate bibliography from DOIs
* `write_dockerfile`: Create reproducible research environments

### Experimental analysis workflow

#### Regression analysis:
* `tidy_lm`: Comprehensive function for running multiple regression specifications
* `robust_se`: Calculate cluster-robust standard errors

#### Table formatting:
* `star_ready`: Prepare tidy_lm output for stargazer tables
* `table_prep` functions: 14 utilities for LaTeX table formatting (add_parentheses, add_endnote, stargazer_pvalues, print_table, etc.)

For more documentation, see the vignettes or add a `?` before any function (e.g., `?PaluckTools::tidy_lm`).

## For Paluck Lab members

To contribute:

1. Clone this package:
   ```bash
   git clone https://github.com/setgree/PaluckTools.git
   ```
2. Add or amend functions and vignettes
3. Open a [pull request](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request)

The first few chapters of [*R packages*](https://r-pkgs.org/) provide excellent guidance on package development.
